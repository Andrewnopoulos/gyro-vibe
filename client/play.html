<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Gyro-Vibe - Mobile Play</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: white;
      overflow: hidden;
    }
    .container {
      max-width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      padding: 15px;
      background-color: #1a1a1a;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-align: center;
    }
    h1 {
      margin: 0;
      font-size: 1.5rem;
      color: #17a2b8;
    }
    .game-area {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .game-button {
      background-color: #17a2b8;
      color: white;
      border: none;
      border-radius: 50px;
      padding: 15px 30px;
      font-size: 1.2rem;
      font-weight: bold;
      margin: 15px;
      width: 80%;
      max-width: 300px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
    }
    .game-button:active {
      transform: scale(0.98);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .info-text {
      margin: 20px;
      text-align: center;
      color: #cccccc;
      font-size: 0.9rem;
      max-width: 300px;
    }
    .qr-option {
      margin-top: 30px;
      padding: 20px;
      background-color: #1a1a1a;
      border-radius: 10px;
      text-align: center;
      max-width: 300px;
    }
    .qr-option h2 {
      font-size: 1rem;
      color: #17a2b8;
      margin-top: 0;
    }
    .secondary-button {
      background-color: #333333;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      margin-top: 10px;
    }
    .canvas-container {
      width: 100%;
      flex-grow: 1;
      display: none; /* Initially hidden */
      position: relative;
    }
    #gameCanvas {
      width: 100%;
      height: 100%;
      background-color: #000;
    }
    .game-controls {
      position: absolute;
      bottom: 20px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .control-button {
      background-color: rgba(23, 162, 184, 0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .back-button {
      position: absolute;
      top: 15px;
      left: 15px;
      background-color: rgba(0,0,0,0.5);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Gyro-Vibe Mobile</h1>
    </div>
    
    <div class="game-area" id="menuScreen">
      <button id="singleplayerBtn" class="game-button">Play Solo</button>
      <button id="multiplayerBtn" class="game-button">Join Multiplayer</button>
      
      <div class="info-text">
        Play directly on your mobile device or connect to a desktop for enhanced experience.
      </div>
      
      <div class="qr-option">
        <h2>Enhanced Desktop Experience</h2>
        <p>Use your phone as a controller for the desktop version</p>
        <button id="desktopLinkBtn" class="secondary-button">Get Desktop Link</button>
      </div>
    </div>
    
    <div class="canvas-container" id="gameScreen">
      <canvas id="gameCanvas"></canvas>
      <button id="backBtn" class="back-button">Back</button>
      <div class="game-controls">
        <button class="control-button">A</button>
        <button class="control-button">B</button>
      </div>
    </div>
  </div>
  
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // DOM elements
    const menuScreen = document.getElementById('menuScreen');
    const gameScreen = document.getElementById('gameScreen');
    const gameCanvas = document.getElementById('gameCanvas');
    const singleplayerBtn = document.getElementById('singleplayerBtn');
    const multiplayerBtn = document.getElementById('multiplayerBtn');
    const desktopLinkBtn = document.getElementById('desktopLinkBtn');
    const backBtn = document.getElementById('backBtn');
    
    // Set up canvas context and resize handling
    const ctx = gameCanvas.getContext('2d');
    
    function resizeCanvas() {
      const container = gameCanvas.parentElement;
      gameCanvas.width = container.clientWidth;
      gameCanvas.height = container.clientHeight;
      // Redraw canvas if needed
      if (gameScreen.style.display === 'block') {
        drawGameScreen();
      }
    }
    
    window.addEventListener('resize', resizeCanvas);
    
    // Simple game state
    const gameState = {
      mode: null, // 'singleplayer' or 'multiplayer'
      active: false,
      orientation: {
        alpha: 0,
        beta: 0,
        gamma: 0
      },
      acceleration: {
        x: 0,
        y: 0,
        z: 0
      }
    };
    
    // Draw the game screen
    function drawGameScreen() {
      ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
      
      // Fill background
      ctx.fillStyle = '#121212';
      ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
      
      // Draw game mode text
      ctx.fillStyle = '#ffffff';
      ctx.font = '18px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(
        gameState.mode === 'singleplayer' ? 'Solo Mode' : 'Multiplayer Mode', 
        gameCanvas.width / 2, 
        30
      );
      
      // Draw orientation data if available
      if (gameState.active) {
        // Center point
        const centerX = gameCanvas.width / 2;
        const centerY = gameCanvas.height / 2;
        
        // Draw a crosshair
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(centerX - 50, centerY);
        ctx.lineTo(centerX + 50, centerY);
        ctx.moveTo(centerX, centerY - 50);
        ctx.lineTo(centerX, centerY + 50);
        ctx.stroke();
        
        // Draw orientation indicator
        const radius = 100;
        const posX = centerX + (gameState.orientation.gamma / 90) * radius;
        const posY = centerY + (gameState.orientation.beta / 90) * radius;
        
        ctx.beginPath();
        ctx.arc(posX, posY, 20, 0, Math.PI * 2);
        ctx.fillStyle = '#17a2b8';
        ctx.fill();
        
        // Display orientation values
        ctx.fillStyle = '#ffffff';
        ctx.font = '14px Arial';
        ctx.textAlign = 'left';
        ctx.fillText(`Alpha: ${gameState.orientation.alpha.toFixed(1)}°`, 20, gameCanvas.height - 80);
        ctx.fillText(`Beta: ${gameState.orientation.beta.toFixed(1)}°`, 20, gameCanvas.height - 60);
        ctx.fillText(`Gamma: ${gameState.orientation.gamma.toFixed(1)}°`, 20, gameCanvas.height - 40);
      } else {
        // Show a message to tilt the device
        ctx.fillStyle = '#ffffff';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Tilt your device to play', centerX, centerY - 20);
        ctx.fillText('Allow sensor access when prompted', centerX, centerY + 20);
      }
    }
    
    // Start the game
    function startGame(mode) {
      gameState.mode = mode;
      gameState.active = false;
      
      // Hide menu, show game
      menuScreen.style.display = 'none';
      gameScreen.style.display = 'block';
      resizeCanvas();
      
      // Start sensor access
      enableSensors();
      
      // Set up the animation loop
      requestAnimationFrame(gameLoop);
    }
    
    // Game loop
    function gameLoop() {
      drawGameScreen();
      requestAnimationFrame(gameLoop);
    }
    
    // Enable device sensors
    async function enableSensors() {
      // Request permission on iOS
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        try {
          const permission = await DeviceOrientationEvent.requestPermission();
          if (permission === 'granted') {
            setupSensors();
          } else {
            console.log('Permission denied for orientation sensors');
          }
        } catch (err) {
          console.error('Error requesting orientation permission:', err);
        }
      } else {
        // Non-iOS devices
        setupSensors();
      }
    }
    
    // Set up sensor event listeners
    function setupSensors() {
      // Orientation sensor
      window.addEventListener('deviceorientation', (event) => {
        gameState.orientation.alpha = event.alpha || 0;
        gameState.orientation.beta = event.beta || 0;
        gameState.orientation.gamma = event.gamma || 0;
        
        // Mark game as active once we receive sensor data
        if (!gameState.active) {
          gameState.active = true;
        }
      });
      
      // Motion sensor
      window.addEventListener('devicemotion', (event) => {
        if (event.accelerationIncludingGravity) {
          gameState.acceleration.x = event.accelerationIncludingGravity.x || 0;
          gameState.acceleration.y = event.accelerationIncludingGravity.y || 0;
          gameState.acceleration.z = event.accelerationIncludingGravity.z || 0;
        }
      });
    }
    
    // Button event listeners
    singleplayerBtn.addEventListener('click', () => {
      startGame('singleplayer');
    });
    
    multiplayerBtn.addEventListener('click', () => {
      startGame('multiplayer');
    });
    
    desktopLinkBtn.addEventListener('click', () => {
      // Provide a way to get to desktop version
      const hostUrl = window.location.origin;
      alert(`Open this URL on your desktop:\n${hostUrl}\n\nThen scan the QR code with your mobile device.`);
    });
    
    backBtn.addEventListener('click', () => {
      // Return to menu
      gameScreen.style.display = 'none';
      menuScreen.style.display = 'flex';
      
      // Stop the game
      gameState.active = false;
      gameState.mode = null;
      
      // Remove sensor event listeners (not implemented in this basic version)
    });
  </script>
</body>
</html>